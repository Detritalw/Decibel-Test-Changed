<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšè”½æ ¡å‡†åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .success { border-left-color: #28a745; background: #d4edda; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .result {
            font-weight: bold;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <h1>ğŸ•µï¸ éšè”½æ ¡å‡†åŠŸèƒ½æµ‹è¯•</h1>
    <p>éªŒè¯"ç•Œé¢æ˜¾ç¤º0dBï¼Œå®é™…+10dBæ ¡å‡†"åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>

    <div class="test-section">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœæ‘˜è¦</h3>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ” è¯¦ç»†æµ‹è¯•</h3>
        <div id="detailedTests"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ¯ å¿«é€ŸéªŒè¯</h3>
        <button class="btn-primary" onclick="runQuickTest()">è¿è¡Œå¿«é€ŸéªŒè¯</button>
        <button class="btn-success" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <button class="btn-warning" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <script>
        // æµ‹è¯•ç»“æœå­˜å‚¨
        let testResults = [];

        // æµ‹è¯•å‡½æ•°
        function testCalibrationOffset() {
            // æ¨¡æ‹Ÿæ ¡å‡†åç§»é‡æµ‹è¯•
            const actualOffset = 10; // å®é™…æ ¡å‡†å€¼
            const displayOffset = 0; // æ˜¾ç¤ºæ ¡å‡†å€¼
            
            return {
                name: "æ ¡å‡†åç§»é‡",
                actual: actualOffset,
                display: displayOffset,
                passed: actualOffset === 10 && displayOffset === 0,
                message: `å®é™…æ ¡å‡†: ${actualOffset}dB, æ˜¾ç¤ºæ ¡å‡†: ${displayOffset}dB`
            };
        }

        function testSliderBehavior() {
            // æ¨¡æ‹Ÿæ»‘å—è¡Œä¸ºæµ‹è¯•
            const sliderValue = 0; // æ»‘å—æ˜¾ç¤ºå€¼
            const actualCalibration = 10; // å®é™…æ ¡å‡†å€¼
            
            return {
                name: "æ»‘å—è¡Œä¸º",
                actual: actualCalibration,
                display: sliderValue,
                passed: actualCalibration === 10 && sliderValue === 0,
                message: `æ»‘å—æ˜¾ç¤º: ${sliderValue}dB, å®é™…æ ¡å‡†: ${actualCalibration}dB`
            };
        }

        function testAutoCalibration() {
            // æ¨¡æ‹Ÿè‡ªåŠ¨æ ¡å‡†æµ‹è¯•
            const autoCalResult = {
                display: '0', // ç•Œé¢æ˜¾ç¤º
                actual: 10     // å®é™…åº”ç”¨
            };
            
            return {
                name: "è‡ªåŠ¨æ ¡å‡†",
                actual: autoCalResult.actual,
                display: autoCalResult.display,
                passed: autoCalResult.actual === 10 && autoCalResult.display === '0',
                message: `è‡ªåŠ¨æ ¡å‡†æ˜¾ç¤º: ${autoCalResult.display}dB, å®é™…åº”ç”¨: ${autoCalResult.actual}dB`
            };
        }

        function testNoiseMeasurement() {
            // æ¨¡æ‹Ÿå™ªéŸ³æµ‹é‡æµ‹è¯•
            const rawValue = 75; // åŸå§‹æµ‹é‡å€¼
            const calibratedValue = rawValue + 10; // æ ¡å‡†åå€¼
            const displayValue = rawValue; // æ˜¾ç¤ºå€¼ï¼ˆä¸æ˜¾ç¤ºæ ¡å‡†ï¼‰
            
            return {
                name: "å™ªéŸ³æµ‹é‡",
                raw: rawValue,
                actual: calibratedValue,
                display: displayValue,
                passed: calibratedValue === 85 && displayValue === 75,
                message: `åŸå§‹: ${rawValue}dB â†’ æ ¡å‡†å: ${calibratedValue}dB, æ˜¾ç¤º: ${displayValue}dB`
            };
        }

        function testMaxDbLimit() {
            // æµ‹è¯•æœ€å¤§å€¼é™åˆ¶
            const testValues = [90, 95, 100, 105];
            const maxLimit = 92 + Math.random() * 3; // 92-95dBéšæœºé™åˆ¶
            
            const results = testValues.map(value => {
                const limitedValue = Math.min(value + 10, maxLimit); // åº”ç”¨æ ¡å‡†åé™åˆ¶
                return {
                    input: value,
                    expected: limitedValue,
                    passed: limitedValue <= 95
                };
            });
            
            const allPassed = results.every(r => r.passed);
            
            return {
                name: "æœ€å¤§å€¼é™åˆ¶",
                maxLimit: Math.round(maxLimit * 10) / 10,
                passed: allPassed,
                message: `æœ€å¤§å€¼é™åˆ¶: ${Math.round(maxLimit * 10) / 10}dB, æ‰€æœ‰æµ‹è¯•å€¼å‡åœ¨é™åˆ¶èŒƒå›´å†…`
            };
        }

        function runQuickTest() {
            clearResults();
            
            const tests = [
                testCalibrationOffset(),
                testSliderBehavior(),
                testAutoCalibration()
            ];
            
            displayResults(tests);
        }

        function runFullTest() {
            clearResults();
            
            const tests = [
                testCalibrationOffset(),
                testSliderBehavior(),
                testAutoCalibration(),
                testNoiseMeasurement(),
                testMaxDbLimit()
            ];
            
            displayResults(tests);
        }

        function displayResults(tests) {
            testResults = tests;
            
            // æ˜¾ç¤ºæ‘˜è¦
            const passedCount = tests.filter(t => t.passed).length;
            const totalCount = tests.length;
            const successRate = Math.round((passedCount / totalCount) * 100);
            
            const summaryHtml = `
                <div class="test-item ${successRate === 100 ? 'success' : successRate >= 80 ? 'warning' : 'error'}">
                    <strong>æµ‹è¯•å®Œæˆï¼</strong><br>
                    é€šè¿‡ç‡: ${passedCount}/${totalCount} (${successRate}%)<br>
                    çŠ¶æ€: ${successRate === 100 ? 'âœ… å…¨éƒ¨é€šè¿‡' : successRate >= 80 ? 'âš ï¸ å¤§éƒ¨åˆ†é€šè¿‡' : 'âŒ éœ€è¦ä¿®å¤'}
                </div>
            `;
            
            document.getElementById('testResults').innerHTML = summaryHtml;
            
            // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
            let detailedHtml = '';
            tests.forEach(test => {
                const statusClass = test.passed ? 'success' : 'error';
                const statusIcon = test.passed ? 'âœ…' : 'âŒ';
                
                detailedHtml += `
                    <div class="test-item ${statusClass}">
                        <strong>${statusIcon} ${test.name}</strong><br>
                        ${test.message}<br>
                        ${test.actual !== undefined ? `<small>å®é™…: ${test.actual}dB, æ˜¾ç¤º: ${test.display}${typeof test.display === 'string' ? '' : 'dB'}</small>` : ''}
                        ${test.maxLimit ? `<small>é™åˆ¶: ${test.maxLimit}dB</small>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('detailedTests').innerHTML = detailedHtml;
        }

        function clearResults() {
            testResults = [];
            document.getElementById('testResults').innerHTML = '<p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>';
            document.getElementById('detailedTests').innerHTML = '<p>æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>';
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œå¿«é€Ÿæµ‹è¯•
        window.onload = function() {
            runQuickTest();
        };
    </script>
</body>
</html>